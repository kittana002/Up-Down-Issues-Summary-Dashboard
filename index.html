<!DOCTYPE html>																									
<html lang="th">																									
<head>																									
<meta charset="UTF-8">																									
<meta name="viewport" content="width=device-width, initial-scale=1.0">																									
<title>แดชบอร์ดสรุปข้อมูล Up/Down</title>																									
<script src="https://cdn.tailwindcss.com"></script>																									
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.3/dist/chart.umd.min.js"></script>																									
<script src="https://unpkg.com/lucide@latest"></script>																									
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Sarabun:wght@400;500;600;700&display=swap" rel="stylesheet">																									
<style>																									
body {																									
font-family: 'Sarabun', 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';																									
background-color: #f8fafc;																									
}																									
.chart-card {																									
height: 400px;																									
}																									
/* Custom scrollbar */																									
::-webkit-scrollbar { width: 8px; height: 8px; }																									
::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }																									
::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }																									
::-webkit-scrollbar-thumb:hover { background: #64748b; }																									
																									
/* Loading Spinner */																									
#loading-overlay {																									
position: fixed;																									
top: 0;																									
left: 0;																									
width: 100%;																									
height: 100%;																									
background-color: rgba(255, 255, 255, 0.8);																									
display: flex;																									
justify-content: center;																									
align-items: center;																									
z-index: 9999;																									
transition: opacity 0.3s;																									
}																									
.spinner {																									
width: 56px;																									
height: 56px;																									
border: 7px solid #4338ca;																									
border-bottom-color: transparent;																									
border-radius: 50%;																									
display: inline-block;																									
box-sizing: border-box;																									
animation: rotation 1s linear infinite;																									
}																									
@keyframes rotation {																									
0% { transform: rotate(0deg); }																									
100% { transform: rotate(360deg); }																									
}																									
</style>																									
</head>																									
<body class="bg-slate-50">																									
																									
<div id="loading-overlay">																									
<div class="spinner" role="status" aria-label="กำลังโหลดข้อมูล"></div>																									
</div>																									
																									
<div id="dashboard-container" class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto text-slate-700 opacity-0 transition-opacity duration-500">																									
<!-- Header -->																									
<header class="mb-8">																									
<div class="flex justify-between items-start flex-wrap gap-4">																									
<div>																									
<h1 class="text-3xl font-bold text-slate-900">แดชบอร์ดสรุปข้อมูล Up/Down</h1>																									
<p class="text-slate-500 mt-1">ภาพรวมสถานะการเชื่อมต่อและประเด็นที่ต้องให้ความสำคัญ</p>																									
</div>																									
<div class="flex flex-col items-end gap-4">																									
<div id="last-updated" class="text-sm text-right text-slate-500" aria-live="polite">																									
<!-- Last updated time will be injected here -->																									
</div>																									
<div class="flex items-center gap-3 flex-wrap justify-end">																									
<button id="refresh-btn" class="flex items-center space-x-2 bg-slate-600 hover:bg-slate-700 text-white text-sm font-semibold py-2 px-3 rounded-lg shadow-md transition-colors duration-300">																									
<i data-lucide="refresh-cw" class="w-4 h-4"></i>																									
<span class="sr-only">รีเฟรชข้อมูล</span>																									
</button>																									
<button id="download-all-btn" class="flex items-center space-x-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm font-semibold py-2 px-3 rounded-lg shadow-md transition-colors duration-300">																									
<i data-lucide="download" class="w-4 h-4" aria-hidden="true"></i>																									
<span>โหลดข้อมูลทั้งหมด</span>																									
</button>																									
</div>																									
</div>																									
</header>																									
																									
<main>																									
<!-- Problem Summary Section -->																									
<section id="problem-summary-section" class="mb-8">																									
<!-- Summary cards will be injected here -->																									
</section>																									
																									
<!-- KPIs -->																									
<section id="kpi-container" aria-labelledby="kpi-heading" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">																									
<!-- KPIs will be injected here -->																									
</section>																									
																									
<!-- Date Trend Chart -->																									
<section aria-labelledby="date-trend-heading" class="mb-8">																									
<div class="bg-white p-6 rounded-2xl shadow-lg chart-card flex flex-col">																									
<h3 id="date-trend-heading" class="text-lg font-semibold text-slate-900 mb-4">จำนวนเคสที่เกิดขึ้นในแต่ละวัน</h3>																									
<div class="relative flex-grow">																									
<canvas id="dateTrendChart"></canvas>																									
</div>																									
</div>																									
</section>																									
																									
<!-- Charts Row 1 -->																									
<section aria-labelledby="charts-row1-heading" class="grid grid-cols-1 lg:grid-cols-5 gap-6 mb-8">																									
<h2 id="charts-row1-heading" class="sr-only">แผนภูมิสรุปผลแถวที่ 1</h2>																									
<div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-2 chart-card flex flex-col">																									
<h3 class="text-lg font-semibold text-slate-900 mb-4">ประเภท Link ที่มีปัญหา</h3>																									
<div class="relative flex-grow">																									
<canvas id="linkTypeChart"></canvas>																									
</div>																									
</div>																									
<div class="bg-white p-6 rounded-2xl shadow-lg lg:col-span-3 chart-card flex flex-col">																									
<h3 class="text-lg font-semibold text-slate-900 mb-4">10 อันดับสาขาที่เกิดปัญหาบ่อยที่สุด</h3>																									
<div id="topIssuesList" class="space-y-3 pr-2 overflow-y-auto flex-grow">																									
<!-- Top issues list will be injected here -->																									
</div>																									
</div>																									
</section>																									
																									
<!-- Charts Row 2 -->																									
<section aria-labelledby="charts-row2-heading" class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">																									
<h2 id="charts-row2-heading" class="sr-only">แผนภูมิสรุปผลแถวที่ 2</h2>																									
<div class="bg-white p-6 rounded-2xl shadow-lg chart-card flex flex-col">																									
<h3 class="text-lg font-semibold text-slate-900 mb-4">จำนวนปัญหาตามภาค</h3>																									
<div class="relative flex-grow">																									
<canvas id="regionChart"></canvas>																									
</div>																									
</div>																									
<div class="bg-white p-6 rounded-2xl shadow-lg chart-card flex flex-col">																									
<h3 class="text-lg font-semibold text-slate-900 mb-4">10 จังหวัดที่เกิดปัญหาบ่อยที่สุด</h3>																									
<div class="relative flex-grow">																									
<canvas id="provinceChart"></canvas>																									
</div>																									
</div>																									
</section>																									
																									
<!-- Recent Events -->																									
<section aria-labelledby="recent-events-heading" class="bg-white p-6 rounded-2xl shadow-lg mb-8">																									
<h2 id="recent-events-heading" class="text-lg font-semibold text-slate-900 mb-4">สรุปเหตุการณ์ Up/Down</h2>																									
<div id="recent-events-container" class="max-h-96 overflow-y-auto">																									
<!-- Recent events accordion will be injected here -->																									
</div>																									
</section>																									
																									
<!-- Attention Table -->																									
<section aria-labelledby="attention-table-heading" class="bg-white p-6 rounded-2xl shadow-lg">																									
<div class="flex justify-between items-center mb-4 flex-wrap gap-2">																									
<h2 id="attention-table-heading" class="text-lg font-semibold text-slate-900">ตารางข้อมูลเหตุการณ์ทั้งหมด</h2>																									
</div>																									
<div class="overflow-x-auto">																									
<table class="w-full text-sm text-left text-slate-500">																									
<thead class="text-xs text-slate-700 uppercase bg-slate-50">																									
<tr>																									
<th scope="col" class="px-6 py-3">วันที่</th>																									
<th scope="col" class="px-6 py-3">รอบ</th>																									
<th scope="col" class="px-6 py-3">ประเภท Link</th>																									
<th scope="col" class="px-6 py-3">รหัสร้าน</th>																									
<th scope="col" class="px-6 py-3">ชื่อร้าน</th>																									
<th scope="col" class="px-6 py-3">จังหวัด</th>																									
<th scope="col" class="px-6 py-3">ภาค</th>																									
<th scope="col" class="px-6 py-3">อาการที่พบ</th>																									
<th scope="col" class="px-6 py-3">สาเหตุ</th>																									
<th scope="col" class="px-6 py-3">วิธีการแก้ไข</th>																									
</tr>																									
</thead>																									
<tbody id="attention-table-body">																									
<!-- Table rows will be injected here -->																									
</tbody>																									
</table>																									
</div>																									
<div id="pagination-container" class="flex justify-center mt-4">																									
<!-- Pagination controls will be injected here -->																									
</div>																									
</section>																									
</main>																									
</div>																									
																									
<script type="module">																									
// --- Application State and Configuration ---																									
const app = {																									
state: {																									
allEventsData: [],																									
charts: {},																									
pagination: {																									
currentPage: 1,																									
itemsPerPage: 10,																									
}																									
},																									
																									
// --- Data Fetching and Parsing ---																									
async fetchData() {																									
const csvData = `วันที่ (Date)	ประเภท Link (Link Type)	รหัสร้าน (Store ID)	ชื่อร้าน (Store Name)	จังหวัด (Province)	ภาค (Region)	อาการที่พบ	สาเหตุ	วิธีการแก้ไข
`;																	
try {																									
const lines = csvData.trim().split('\n');																									
const headers = lines[0].split('\t').map(h => h.trim());																									
const data = lines.slice(1).map(line => {																									
const values = line.split('\t');																									
let obj = {};																									
headers.forEach((header, index) => {																									
let value = values[index] ? values[index].trim() : '';																									
if (header === 'ประเภท Link (Link Type)') {																									
value = value.replace('(FTTX) (FTTX)', '(FTTX)');																									
}																									
obj[header] = value;																									
});																									
return obj;																									
});																									
this.state.allEventsData = data;																									
} catch (error) {																									
console.error("Failed to parse CSV data:", error);																									
alert("ไม่สามารถแปลงข้อมูล CSV ได้");																									
this.state.allEventsData = [];																									
}																									
},																									
																									
// --- Data Processing ---																									
processData() {																									
const data = this.state.allEventsData;																									
																									
const createDetailedSummary = (data, columnName) => {																									
const counts = data.reduce((acc, d) => {																									
const item = d[columnName];																									
if (item && item.trim() !== '' && item.trim() !== '-' && item.trim().toLowerCase() !== 'n/a') {																									
acc[item] = (acc[item] || 0) + 1;																									
}																									
return acc;																									
}, {});																									
																									
const totalCount = Object.values(counts).reduce((sum, count) => sum + count, 0);																									
																									
if (totalCount === 0) {																									
return [];																									
}																									
																									
return Object.entries(counts)																									
.map(([name, count]) => ({																									
name,																									
count,																									
percentage: ((count / totalCount) * 100).toFixed(3)																									
}))																									
.sort((a, b) => b.count - a.count);																									
};																									
																									
const symptomDetails = createDetailedSummary(data, 'อาการที่พบ');																									
const causeDetails = createDetailedSummary(data, 'สาเหตุ');																									
const solutionDetails = createDetailedSummary(data, 'วิธีการแก้ไข');																									
																									
const linkTypeCounts = data.reduce((acc, d) => {																									
const type = d['ประเภท Link (Link Type)'];																									
if (type) acc[type] = (acc[type] || 0) + 1;																									
return acc;																									
}, {});																									
																									
const storeIssueCounts = data.reduce((acc, d) => {																									
const storeId = d['รหัสร้าน (Store ID)'];																									
const storeName = d['ชื่อร้าน (Store Name)'];																									
if (storeId) {																									
if (!acc[storeId]) {																									
acc[storeId] = { name: storeName, count: 0 };																									
}																									
acc[storeId].count++;																									
}																									
return acc;																									
}, {});																									
																									
const topStoreIssues = Object.entries(storeIssueCounts)																									
.map(([id, data]) => ({ id, name: data.name, count: data.count }))																									
.sort((a, b) => b.count - a.count)																									
.slice(0, 10);																									
																									
const regionCounts = data.reduce((acc, d) => {																									
const region = d['ภาค (Region)'];																									
if (region) acc[region] = (acc[region] || 0) + 1;																									
return acc;																									
}, {});																									
																									
const provinceCounts = data.reduce((acc, d) => {																									
const province = d['จังหวัด (Province)'];																									
if (province) acc[province] = (acc[province] || 0) + 1;																									
return acc;																									
}, {});																									
const topProvinces = Object.entries(provinceCounts).map(([name, value]) => ({ name, value })).sort((a, b) => b.value - a.value).slice(0, 10);																									
																									
const eventsByDate = data.reduce((acc, d) => {																									
const date = d['วันที่ (Date)'];																									
if (!date) return acc;																									
if (!acc[date]) {																									
acc[date] = { main: [], backup: [] };																									
}																									
const eventDetail = { id: d['รหัสร้าน (Store ID)'], name: d['ชื่อร้าน (Store Name)'] };																									
if (d['ประเภท Link (Link Type)'].includes('Main')) {																									
acc[date].main.push(eventDetail);																									
} else {																									
acc[date].backup.push(eventDetail);																									
}																									
return acc;																									
}, {});																									
																									
const recentEvents = Object.entries(eventsByDate).map(([date, data]) => ({ date, ...data })).sort((a,b) => {																									
const dateA = a.date.split('/').reverse().join('-');																									
const dateB = b.date.split('/').reverse().join('-');																									
return new Date(dateB) - new Date(dateA);																									
});																									
																									
const dateCounts = data.reduce((acc, d) => {																									
const date = d['วันที่ (Date)'];																									
if (date) acc[date] = (acc[date] || 0) + 1;																									
return acc;																									
}, {});																									
const dateTrendData = Object.entries(dateCounts).sort((a,b) => {																									
const dateA = a[0].split('/').reverse().join('-');																									
const dateB = b[0].split('/').reverse().join('-');																									
return new Date(dateA) - new Date(dateB);																									
});																									
																									
																									
return {																									
totalIssues: data.length,																									
linkTypeCounts,																									
topStoreIssues,																									
regionCounts,																									
topProvinces,																									
recentEvents,																									
dateTrendData,																									
symptomDetails,																									
causeDetails,																									
solutionDetails																									
};																									
},																									
																									
// --- Rendering Functions ---																									
render() {																									
const data = this.processData();																									
this.renderProblemSummary(data);																									
this.renderKPIs(data);																									
this.renderCharts(data);																									
this.renderTopIssuesList(data);																									
this.renderRecentEvents(data);																									
this.renderAttentionTable();																									
lucide.createIcons();																									
},																									
																									
renderProblemSummary(data) {																									
const createSummaryCardHTML = (title, icon, color, details) => {																									
if (details.length === 0) {																									
return `																									
<div class="bg-white p-6 rounded-2xl shadow-lg">																									
<div class="flex items-center mb-2">																									
<div class="bg-${color}-100 p-3 rounded-full mr-4"><i data-lucide="${icon}" class="w-6 h-6 text-${color}-600"></i></div>																									
<div>																									
<p class="text-sm text-gray-500 font-medium">${title}</p>																									
<p class="text-lg font-bold text-gray-800">ไม่มีข้อมูล</p>																									
</div>																									
</div>																									
</div>																									
`;																									
}																									
																									
let detailsHTML = details.map(item => `																									
<div class="mt-2">																									
<div class="flex justify-between mb-1">																									
<span class="text-sm font-medium text-gray-700 truncate" title="${item.name}">${item.name}</span>																									
<span class="text-sm font-medium text-gray-700">${item.percentage}%</span>																									
</div>																									
<div class="w-full bg-gray-200 rounded-full h-2.5">																									
<div class="bg-${color}-400 h-2.5 rounded-full" style="width: ${item.percentage}%"></div>																									
</div>																									
</div>																									
`).join('');																									
																									
return `																									
<div class="bg-white p-6 rounded-2xl shadow-lg">																									
<div class="flex items-center mb-2">																									
<div class="bg-${color}-100 p-3 rounded-full mr-4"><i data-lucide="${icon}" class="w-6 h-6 text-${color}-600"></i></div>																									
<div><p class="text-lg font-semibold text-gray-800">${title}</p></div>																									
</div>																									
<div class="mt-4 max-h-48 overflow-y-auto pr-2">																									
${detailsHTML}																									
</div>																									
</div>																									
`;																									
};																									
																									
const container = document.getElementById('problem-summary-section');																									
container.innerHTML = `																									
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">																									
${createSummaryCardHTML('อาการที่พบ', 'alert-triangle', 'yellow', data.symptomDetails)}																									
${createSummaryCardHTML('สาเหตุ', 'wrench', 'red', data.causeDetails)}																									
${createSummaryCardHTML('วิธีการแก้ไข', 'shield-check', 'green', data.solutionDetails)}																									
</div>																									
`;																									
},																									
																									
renderKPIs(data) {																									
const container = document.getElementById('kpi-container');																									
const regionCounts = data.regionCounts;																									
const mostProblematicRegion = Object.keys(regionCounts).length > 0 ? Object.keys(regionCounts).reduce((a, b) => regionCounts[a] > regionCounts[b] ? a : b, 'N/A') : 'N/A';																									
																									
container.innerHTML = `																									
<div class="bg-white p-6 rounded-2xl shadow-lg" data-tooltip="จำนวนเหตุการณ์ Up/Down ทั้งหมดที่บันทึก">																									
<div class="flex items-center"><div class="p-3 rounded-xl mr-4 bg-red-500"><i data-lucide="alert-circle" class="h-6 w-6 text-white"></i></div><div><p class="text-sm text-gray-500 font-medium">รวมทุกเหตุการณ์</p><p class="text-2xl font-bold text-gray-800">${data.totalIssues}</p></div></div>																									
</div>																									
<div class="bg-white p-6 rounded-2xl shadow-lg" data-tooltip="จำนวนปัญหาที่เกิดกับ Main Link">																									
<div class="flex items-center"><div class="p-3 rounded-xl mr-4 bg-blue-500"><i data-lucide="arrow-up-circle" class="h-6 w-6 text-white"></i></div><div><p class="text-sm text-gray-500 font-medium">ปัญหา Main Link</p><p class="text-2xl font-bold text-gray-800">${data.linkTypeCounts['Main Link'] || 0}</p></div></div>																									
</div>																									
<div class="bg-white p-6 rounded-2xl shadow-lg" data-tooltip="จำนวนปัญหาที่เกิดกับ Backup 4G">																									
<div class="flex items-center"><div class="p-3 rounded-xl mr-4 bg-yellow-500"><i data-lucide="arrow-down-circle" class="h-6 w-6 text-white"></i></div><div><p class="text-sm text-gray-500 font-medium">ปัญหา Backup 4G</p><p class="text-2xl font-bold text-gray-800">${data.linkTypeCounts['Backup 4G'] || 0}</p></div></div>																									
</div>																									
<div class="bg-white p-6 rounded-2xl shadow-lg" data-tooltip="ภาคที่พบปัญหาบ่อยที่สุด">																									
<div class="flex items-center"><div class="p-3 rounded-xl mr-4 bg-orange-500"><i data-lucide="globe" class="h-6 w-6 text-white"></i></div><div><p class="text-sm text-gray-500 font-medium">ภาคที่เกิดปัญหาบ่อยสุด</p><p class="text-2xl font-bold text-gray-800">${mostProblematicRegion}</p></div></div>																									
</div>																									
`;																									
},																									
																									
renderCharts(data) {																									
const BAR_COLORS = ['#60A5FA', '#A78BFA', '#F472B6', '#FBBF24', '#34D399', '#FB923C', '#4ADE80', '#2DD4BF', '#818CF8', '#E879F9'];																									
const PIE_COLORS = { 'Main Link': '#3B82F6', 'Backup 4G': '#F59E0B' };																									
																									
const textColor = '#1e293b';																									
const gridColor = 'rgba(0, 0, 0, 0.1)';																									
																									
Object.values(this.state.charts).forEach(chart => chart.destroy());																									
																									
const sharedChartOptions = {																									
responsive: true,																									
maintainAspectRatio: false,																									
plugins: {																									
legend: { labels: { color: textColor } },																									
title: { display: false }																									
},																									
scales: {																									
y: { ticks: { color: textColor }, grid: { color: gridColor }, title: { color: textColor, display: false } },																									
x: { ticks: { color: textColor }, grid: { color: gridColor }, title: { color: textColor, display: false } }																									
}																									
};																									
																									
this.state.charts.dateTrendChart = new Chart(document.getElementById('dateTrendChart'), {																									
type: 'bar',																									
data: {																									
labels: data.dateTrendData.map(d => d[0]),																									
datasets: [{																									
label: 'จำนวนปัญหา',																									
data: data.dateTrendData.map(d => d[1]),																									
backgroundColor: '#4f46e5',																									
}]																									
},																									
options: { ...sharedChartOptions, plugins: { ...sharedChartOptions.plugins, legend: { display: false } } }																									
});																									
																									
this.state.charts.linkTypeChart = new Chart(document.getElementById('linkTypeChart'), {																									
type: 'pie',																									
data: {																									
labels: Object.keys(data.linkTypeCounts),																									
datasets: [{ data: Object.values(data.linkTypeCounts), backgroundColor: Object.keys(data.linkTypeCounts).map(k => PIE_COLORS[k]), borderColor: '#ffffff', borderWidth: 2 }]																									
},																									
options: { ...sharedChartOptions, plugins: { ...sharedChartOptions.plugins, legend: { ...sharedChartOptions.plugins.legend, position: 'bottom' } } }																									
});																									
																									
this.state.charts.regionChart = new Chart(document.getElementById('regionChart'), {																									
type: 'bar',																									
data: {																									
labels: Object.keys(data.regionCounts),																									
datasets: [{ label: 'จำนวนครั้ง', data: Object.values(data.regionCounts), backgroundColor: BAR_COLORS }]																									
},																									
options: { ...sharedChartOptions, plugins: { ...sharedChartOptions.plugins, legend: { display: false } } }																									
});																									
																									
this.state.charts.provinceChart = new Chart(document.getElementById('provinceChart'), {																									
type: 'bar',																									
data: {																									
labels: data.topProvinces.map(p => p.name),																									
datasets: [{ label: 'จำนวนครั้ง', data: data.topProvinces.map(p => p.value), backgroundColor: BAR_COLORS.slice().reverse() }]																									
},																									
options: {																									
...sharedChartOptions,																									
indexAxis: 'y',																									
scales: { ...sharedChartOptions.scales, y: { ...sharedChartOptions.scales.y, ticks: { ...sharedChartOptions.scales.y.ticks, font: { size: 10 } } } }																									
}																									
});																									
},																									
																									
renderTopIssuesList(data) {																									
const container = document.getElementById('topIssuesList');																									
if (data.topStoreIssues.length === 0) {																									
container.innerHTML = '<p class="text-center text-gray-500">ไม่มีข้อมูล</p>';																									
return;																									
}																									
const maxCount = Math.max(...data.topStoreIssues.map(d => d.count));																									
container.innerHTML = data.topStoreIssues.map(item => `																									
<div class="bg-gray-100 p-3 rounded-lg">																									
<div class="flex justify-between items-center mb-2 gap-2 flex-wrap">																									
<p class="font-bold text-sm text-gray-800 truncate pr-2 flex-1 min-w-0">${item.name} (${item.id})</p>																									
<p class="text-sm font-semibold text-indigo-600 whitespace-nowrap flex-shrink-0">${item.count} ครั้ง</p>																									
</div>																									
<div class="w-full bg-gray-200 rounded-full h-2.5" aria-label="แถบแสดงจำนวนปัญหา">																									
<div class="bg-indigo-500 h-2.5 rounded-full" style="width: ${maxCount > 0 ? (item.count / maxCount) * 100 : 0}%"></div>																									
</div>																									
</div>																									
`).join('');																									
},																									
																									
renderAttentionTable() {																									
const tableBody = document.getElementById('attention-table-body');																									
const { currentPage, itemsPerPage } = this.state.pagination;																									
const data = this.state.allEventsData;																									
																									
if (data.length === 0) {																									
tableBody.innerHTML = `<tr><td colspan="10" class="text-center py-8 text-gray-500">ไม่พบข้อมูล</td></tr>`;																									
return;																									
}																									
																									
const startIndex = (currentPage - 1) * itemsPerPage;																									
const endIndex = startIndex + itemsPerPage;																									
const paginatedData = data.slice(startIndex, endIndex);																									
																									
tableBody.innerHTML = paginatedData.map(item => `																									
<tr class="bg-white border-b hover:bg-gray-50">																									
<td class="px-6 py-4">${item['วันที่ (Date)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['รอบ (Period)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['ประเภท Link (Link Type)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['รหัสร้าน (Store ID)'] || 'N/A'}</td>																									
<td class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap">${item['ชื่อร้าน (Store Name)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['จังหวัด (Province)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['ภาค (Region)'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['อาการที่พบ'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['สาเหตุ'] || 'N/A'}</td>																									
<td class="px-6 py-4">${item['วิธีการแก้ไข'] || 'N/A'}</td>																									
</tr>																									
`).join('');																									
																									
this.renderPaginationControls();																									
},																									
																									
renderPaginationControls() {																									
const { currentPage, itemsPerPage } = this.state.pagination;																									
const totalItems = this.state.allEventsData.length;																									
const totalPages = Math.ceil(totalItems / itemsPerPage);																									
const container = document.getElementById('pagination-container');																									
																									
if (totalPages <= 1) {																									
container.innerHTML = '';																									
return;																									
}																									
																									
let paginationHTML = '<nav aria-label="Pagination"><ul class="flex items-center -space-x-px h-8 text-sm">';																									
																									
paginationHTML += `<li><button id="prev-page" class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-lg hover:bg-gray-100 hover:text-gray-700" ${currentPage === 1 ? 'disabled' : ''}>ก่อนหน้า</button></li>`;																									
																									
const pagesPerBlock = 5;																									
const currentBlock = Math.ceil(currentPage / pagesPerBlock);																									
const startPage = (currentBlock - 1) * pagesPerBlock + 1;																									
const endPage = Math.min(startPage + pagesPerBlock - 1, totalPages);																									
																									
for (let i = startPage; i <= endPage; i++) {																									
const activeClasses = 'z-10 flex items-center justify-center px-3 h-8 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700';																									
const defaultClasses = 'flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700';																									
paginationHTML += `<li><button data-page="${i}" class="${currentPage === i ? activeClasses : defaultClasses}">${i}</button></li>`;																									
}																									
																									
paginationHTML += `<li><button id="next-page" class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-lg hover:bg-gray-100 hover:text-gray-700" ${currentPage === totalPages ? 'disabled' : ''}>ถัดไป</button></li>`;																									
																									
paginationHTML += '</ul></nav>';																									
container.innerHTML = paginationHTML;																									
},																									
																									
renderRecentEvents(data) {																									
const container = document.getElementById('recent-events-container');																									
if (data.recentEvents.length === 0) {																									
container.innerHTML = '<p class="text-center text-gray-500">ไม่มีข้อมูลเหตุการณ์ล่าสุด</p>';																									
return;																									
}																									
container.innerHTML = data.recentEvents.map((event, idx) => `																									
<div class="border-b border-gray-200">																									
<details class="group" ${idx < 3 ? 'open' : ''}>																									
<summary class="flex justify-between items-center w-full py-3 px-1 text-left font-medium text-gray-700 hover:bg-gray-100 cursor-pointer list-none">																									
<span>วันที่: ${event.date}</span>																									
<i data-lucide="chevron-down" class="w-5 h-5 transition-transform group-open:rotate-180"></i>																									
</summary>																									
<div class="p-4 bg-gray-50 rounded-b-lg">																									
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">																									
<div>																									
<h4 class="font-semibold mb-2 text-indigo-600">Main Link Issues (${event.main.length})</h4>																									
<ul class="list-disc list-inside text-sm space-y-1 text-gray-600">${event.main.length > 0 ? event.main.map(store => `<li key=${store.id}>${store.id} - ${store.name}</li>`).join('') : '<li>ไม่มี</li>'}</ul>																									
</div>																									
<div>																									
<h4 class="font-semibold mb-2 text-sky-600">Backup 4G Issues (${event.backup.length})</h4>																									
<ul class="list-disc list-inside text-sm space-y-1 text-gray-600">${event.backup.length > 0 ? event.backup.map(store => `<li key=${store.id}>${store.id} - ${store.name}</li>`).join('') : '<li>ไม่มี</li>'}</ul>																									
</div>																									
</div>																									
</div>																									
</details>																									
</div>																									
`).join('');																									
},																									
																									
setupEventListeners() {																									
document.getElementById('download-all-btn').addEventListener('click', () => {																									
const data = this.state.allEventsData;																									
if (data.length > 0) {																									
const headers = Object.keys(data[0]);																									
const csvRows = [headers.join(',')];																									
data.forEach(row => {																									
const values = headers.map(header => {																									
let cell = row[header] === null || row[header] === undefined ? '' : String(row[header]);																									
if (/[",\n]/.test(cell)) {																									
cell = `"${cell.replace(/"/g, '""')}"`;																									
}																									
return cell;																									
});																									
csvRows.push(values.join(','));																									
});																									
const csvString = '\uFEFF' + csvRows.join('\n');																									
const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });																									
const link = document.createElement('a');																									
const url = URL.createObjectURL(blob);																									
link.setAttribute('href', url);																									
link.setAttribute('download', 'all_events_data.csv');																									
link.style.visibility = 'hidden';																									
document.body.appendChild(link);																									
link.click();																									
document.body.removeChild(link);																									
} else {																									
alert("ไม่มีข้อมูลสำหรับดาวน์โหลด");																									
}																									
});																									
document.getElementById('refresh-btn').addEventListener('click', () => this.init());																									
																									
document.getElementById('pagination-container').addEventListener('click', (e) => {																									
const button = e.target.closest('button');																									
if (!button || button.disabled) return;																									
																									
const page = button.dataset.page;																									
if (page) {																									
this.state.pagination.currentPage = parseInt(page, 10);																									
} else if (button.id === 'prev-page') {																									
this.state.pagination.currentPage--;																									
} else if (button.id === 'next-page') {																									
this.state.pagination.currentPage++;																									
}																									
this.renderAttentionTable();																									
});																									
},																									
																									
async init() {																									
const loadingOverlay = document.getElementById('loading-overlay');																									
const dashboardContainer = document.getElementById('dashboard-container');																									
																									
loadingOverlay.style.display = 'flex';																									
dashboardContainer.style.opacity = 0;																									
																									
await this.fetchData();																									
this.render();																									
this.setupEventListeners();																									
																									
document.getElementById('last-updated').textContent = `อัปเดตล่าสุด: ${new Date().toLocaleString('th-TH', { dateStyle: 'medium', timeStyle: 'short' })}`;																									
																									
loadingOverlay.style.display = 'none';																									
dashboardContainer.style.opacity = 1;																									
}																									
};																									
																									
app.init();																									
</script>																									
</body>																									
</html>																									


